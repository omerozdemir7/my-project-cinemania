{"version":3,"file":"my-library-CmCxw1Yf.js","sources":["../../src/js/my-library.js"],"sourcesContent":["// src/js/my-library.js\r\nimport { fetchMovieDetails } from './movies-data.js';\r\nimport { renderMovieCard, updateHeroWithMovie } from './ui-helpers.js';\r\n\r\nconst initLibrary = async () => {\r\n  const grid = document.getElementById('library-grid');\r\n  const heroSection = document.getElementById('library-hero');\r\n  const heroContent = document.getElementById('library-hero-content');\r\n  const genreContainer = document.getElementById('genre-filter-container');\r\n  const genreHeader = document.getElementById('genre-header');\r\n  const genreTextSpan = document.getElementById('selected-genre-text');\r\n  const genreList = document.getElementById('genre-list');\r\n  const loadMoreContainer = document.getElementById('load-more-container');\r\n  const loadMoreBtn = document.getElementById('load-more-btn');\r\n\r\n  if (!grid) return;\r\n\r\n  const storedIds = JSON.parse(localStorage.getItem('myLibrary') || '[]');\r\n  const numericIds = (Array.isArray(storedIds) ? storedIds : [])\r\n    .map((v) => Number(v))\r\n    .filter((v) => Number.isFinite(v) && v > 0);\r\n\r\n  if (!numericIds.length) {\r\n    grid.innerHTML = `\r\n      <div class=\"library-message\">\r\n        <p style=\"font-size: 24px; font-weight: 500; margin-bottom: 10px;\">OOPS...</p>\r\n        <p>Henüz bir film eklemediniz!</p>\r\n        <a href=\"/catalog.html\" class=\"btn btn-primary\" style=\"margin-top:20px; display:inline-block;\">Kataloğa Git</a>\r\n      </div>`;\r\n    if (genreContainer) genreContainer.style.display = 'none';\r\n    if (loadMoreContainer) loadMoreContainer.classList.add('is-hidden');\r\n    return;\r\n  }\r\n\r\n  const results = await Promise.allSettled(\r\n    numericIds.map((id) => fetchMovieDetails(id))\r\n  );\r\n\r\n  const allMovies = [];\r\n  const successfulIds = [];\r\n\r\n  results.forEach((r, idx) => {\r\n    const id = numericIds[idx];\r\n    if (r.status === 'fulfilled' && r.value) {\r\n      allMovies.push(r.value);\r\n      successfulIds.push(id);\r\n    }\r\n  });\r\n\r\n  localStorage.setItem('myLibrary', JSON.stringify(successfulIds));\r\n\r\n  if (allMovies.length > 0) {\r\n    await updateHeroWithMovie(allMovies[0].id, heroSection, heroContent);\r\n  }\r\n\r\n  // Tür Filtreleme\r\n  const availableGenres = new Map();\r\n  allMovies.forEach((movie) => {\r\n    if (movie.genres) {\r\n      movie.genres.forEach((g) => availableGenres.set(g.id, g.name));\r\n    }\r\n  });\r\n\r\n  if (genreList) {\r\n    const allItem = document.createElement('div');\r\n    allItem.className = 'genre-item active';\r\n    allItem.textContent = 'All Genres';\r\n    allItem.dataset.id = 'all';\r\n    genreList.appendChild(allItem);\r\n\r\n    availableGenres.forEach((name, id) => {\r\n      const item = document.createElement('div');\r\n      item.className = 'genre-item';\r\n      item.textContent = name;\r\n      item.dataset.id = id;\r\n      genreList.appendChild(item);\r\n    });\r\n  }\r\n\r\n  if (genreHeader) {\r\n    genreHeader.addEventListener('click', (e) => {\r\n      e.stopPropagation();\r\n      genreList.classList.toggle('is-hidden');\r\n      genreContainer.classList.toggle('is-open');\r\n    });\r\n  }\r\n\r\n  document.addEventListener('click', (e) => {\r\n    if (genreContainer && !genreContainer.contains(e.target)) {\r\n      genreList.classList.add('is-hidden');\r\n      genreContainer.classList.remove('is-open');\r\n    }\r\n  });\r\n\r\n  let currentGenreId = 'all';\r\n  let filteredMovies = [...allMovies];\r\n\r\n  if (genreList) {\r\n    genreList.addEventListener('click', (e) => {\r\n      if (e.target.classList.contains('genre-item')) {\r\n        currentGenreId = e.target.dataset.id;\r\n        const genreName = e.target.textContent;\r\n        if (genreTextSpan) genreTextSpan.textContent = genreName === 'All Genres' ? 'Genre' : genreName;\r\n\r\n        document.querySelectorAll('.genre-item').forEach((item) => item.classList.remove('active'));\r\n        e.target.classList.add('active');\r\n        genreList.classList.add('is-hidden');\r\n        genreContainer.classList.remove('is-open');\r\n        applyFilter();\r\n      }\r\n    });\r\n  }\r\n\r\n  let renderedCount = 0;\r\n  const PER_PAGE = 6;\r\n\r\n  function applyFilter() {\r\n    if (currentGenreId === 'all') {\r\n      filteredMovies = [...allMovies];\r\n    } else {\r\n      filteredMovies = allMovies.filter((m) =>\r\n        m.genres.some((g) => g.id.toString() === currentGenreId.toString())\r\n      );\r\n    }\r\n\r\n    renderedCount = 0;\r\n    grid.innerHTML = '';\r\n\r\n    if (filteredMovies.length === 0) {\r\n      grid.innerHTML = `<div class=\"library-message\">Bu türde film bulunamadı.</div>`;\r\n      if (loadMoreContainer) loadMoreContainer.classList.add('is-hidden');\r\n    } else {\r\n      renderBatch();\r\n    }\r\n  }\r\n\r\n  function renderBatch() {\r\n    const nextBatch = filteredMovies.slice(renderedCount, renderedCount + PER_PAGE);\r\n    const html = nextBatch.map((m) => renderMovieCard(m)).join('');\r\n    grid.insertAdjacentHTML('beforeend', html);\r\n    renderedCount += nextBatch.length;\r\n\r\n    if (renderedCount >= filteredMovies.length) {\r\n      if (loadMoreContainer) loadMoreContainer.classList.add('is-hidden');\r\n    } else {\r\n      if (loadMoreContainer) loadMoreContainer.classList.remove('is-hidden');\r\n    }\r\n  }\r\n\r\n  if (loadMoreBtn) {\r\n    loadMoreBtn.addEventListener('click', renderBatch);\r\n  }\r\n\r\n  renderBatch();\r\n\r\n  grid.addEventListener('click', (e) => {\r\n    const card = e.target.closest('.movie-card');\r\n    if (card && card.dataset.id) {\r\n      updateHeroWithMovie(card.dataset.id, heroSection, heroContent);\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    }\r\n  });\r\n};\r\n\r\ninitLibrary();"],"names":["initLibrary","grid","heroSection","heroContent","genreContainer","genreHeader","genreTextSpan","genreList","loadMoreContainer","loadMoreBtn","storedIds","numericIds","v","results","id","fetchMovieDetails","allMovies","successfulIds","r","idx","updateHeroWithMovie","availableGenres","movie","g","allItem","name","item","currentGenreId","filteredMovies","genreName","applyFilter","renderedCount","PER_PAGE","m","renderBatch","nextBatch","html","renderMovieCard","card"],"mappings":"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"}