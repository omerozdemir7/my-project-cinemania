{"version":3,"file":"my-library-CcAETZQ8.js","sources":["../../src/js/my-library.js"],"sourcesContent":["// src/js/my-library.js\r\n\r\nimport { getUserLibrary, auth } from './auth.js';\r\nimport { onAuthStateChanged } from \"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js\";\r\nimport { fetchMovieDetails } from './movies-data.js';\r\nimport { renderMovieCard, updateHeroWithMovie } from './ui-helpers.js';\r\nimport { showLoader, hideLoader } from './loader.js';\r\n\r\nconst initLibrary = () => {\r\n  const libraryGrid = document.getElementById('library-grid');\r\n  const heroSection = document.getElementById('library-hero');\r\n  const heroContent = document.getElementById('library-hero-content');\r\n  \r\n  // Boş mesaj elementi yoksa JS ile oluşturup ekleyelim\r\n  let emptyMsg = document.getElementById('empty-library-msg');\r\n  if (!emptyMsg && libraryGrid) {\r\n    emptyMsg = document.createElement('div');\r\n    emptyMsg.id = 'empty-library-msg';\r\n    emptyMsg.className = 'empty-library is-hidden';\r\n    emptyMsg.innerHTML = `\r\n      <p>OOPS...</p>\r\n      <p>You haven't added any movies yet.</p>\r\n      <a href=\"catalog.html\" style=\"color:var(--primary-orange, orange); margin-top:15px; display:inline-block;\">Go to Catalog</a>\r\n    `;\r\n    // Grid'in hemen öncesine ekle\r\n    libraryGrid.parentNode.insertBefore(emptyMsg, libraryGrid);\r\n  }\r\n\r\n  if (!libraryGrid) return;\r\n\r\n  // --- LİSTEYİ YÜKLEME FONKSİYONU ---\r\n  async function loadLibraryMovies() {\r\n    showLoader();\r\n    libraryGrid.innerHTML = ''; // Temizle\r\n    if (emptyMsg) emptyMsg.classList.add('is-hidden');\r\n\r\n    try {\r\n      // 1. Film ID'lerini çek (Firebase veya LocalStorage)\r\n      const movieIds = await getUserLibrary();\r\n\r\n      // 2. Eğer liste boşsa\r\n      if (!movieIds || movieIds.length === 0) {\r\n        hideLoader();\r\n        if (emptyMsg) emptyMsg.classList.remove('is-hidden');\r\n        if (heroSection) heroSection.style.backgroundImage = 'none';\r\n        if (heroContent) heroContent.innerHTML = '<h1>Your Library is Empty</h1>';\r\n        return;\r\n      }\r\n\r\n      // 3. ID'leri kullanarak film detaylarını API'den çek\r\n      const promises = movieIds.map(id => fetchMovieDetails(id));\r\n      const movies = await Promise.all(promises);\r\n\r\n      // 4. Filmleri Ekrana Bas (Hatalı/Silinmiş olanları filtrele)\r\n      const validMovies = movies.filter(m => m !== null);\r\n      \r\n      libraryGrid.innerHTML = validMovies.map(m => renderMovieCard(m)).join('');\r\n\r\n      // 5. İlk filmi Hero alanına koy\r\n      if (validMovies.length > 0 && heroSection) {\r\n        updateHeroWithMovie(validMovies[0].id, heroSection, heroContent);\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error(\"Kütüphane yüklenirken hata:\", error);\r\n      libraryGrid.innerHTML = '<p style=\"color:white; text-align:center;\">Bir hata oluştu.</p>';\r\n    } finally {\r\n      hideLoader();\r\n    }\r\n  }\r\n\r\n  // --- OTURUM DURUMUNU DİNLE ---\r\n  // Sayfa açıldığında Firebase'in durumunu bekliyoruz\r\n  onAuthStateChanged(auth, (user) => {\r\n    loadLibraryMovies();\r\n  });\r\n  \r\n  // Kartlara tıklayınca Hero güncelle\r\n  libraryGrid.addEventListener('click', (e) => {\r\n    const card = e.target.closest('.movie-card');\r\n    if (card && card.dataset.id && heroSection) {\r\n      updateHeroWithMovie(card.dataset.id, heroSection, heroContent);\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    }\r\n  });\r\n};\r\n\r\n// Başlat\r\ninitLibrary();"],"names":["initLibrary","libraryGrid","heroSection","heroContent","emptyMsg","loadLibraryMovies","showLoader","movieIds","getUserLibrary","hideLoader","promises","id","fetchMovieDetails","validMovies","m","renderMovieCard","updateHeroWithMovie","error","onAuthStateChanged","auth","user","e","card"],"mappings":"6TAQA,MAAMA,EAAc,IAAM,CACxB,MAAMC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAc,SAAS,eAAe,sBAAsB,EAGlE,IAAIC,EAAW,SAAS,eAAe,mBAAmB,EAc1D,GAbI,CAACA,GAAYH,IACfG,EAAW,SAAS,cAAc,KAAK,EACvCA,EAAS,GAAK,oBACdA,EAAS,UAAY,0BACrBA,EAAS,UAAY;AAAA;AAAA;AAAA;AAAA,MAMrBH,EAAY,WAAW,aAAaG,EAAUH,CAAW,GAGvD,CAACA,EAAa,OAGlB,eAAeI,GAAoB,CACjCC,IACAL,EAAY,UAAY,GACpBG,GAAUA,EAAS,UAAU,IAAI,WAAW,EAEhD,GAAI,CAEF,MAAMG,EAAW,MAAMC,IAGvB,GAAI,CAACD,GAAYA,EAAS,SAAW,EAAG,CACtCE,IACIL,GAAUA,EAAS,UAAU,OAAO,WAAW,EAC/CF,IAAaA,EAAY,MAAM,gBAAkB,QACjDC,IAAaA,EAAY,UAAY,kCACzC,MACF,CAGA,MAAMO,EAAWH,EAAS,IAAII,GAAMC,EAAkBD,CAAE,CAAC,EAInDE,GAHS,MAAM,QAAQ,IAAIH,CAAQ,GAGd,OAAOI,GAAKA,IAAM,IAAI,EAEjDb,EAAY,UAAYY,EAAY,IAAIC,GAAKC,EAAgBD,CAAC,CAAC,EAAE,KAAK,EAAE,EAGpED,EAAY,OAAS,GAAKX,GAC5Bc,EAAoBH,EAAY,CAAC,EAAE,GAAIX,EAAaC,CAAW,CAGnE,OAASc,EAAO,CACd,QAAQ,MAAM,8BAA+BA,CAAK,EAClDhB,EAAY,UAAY,iEAC1B,QAAC,CACCQ,GACF,CACF,CAIAS,EAAmBC,EAAOC,GAAS,CACjCf,GACF,CAAC,EAGDJ,EAAY,iBAAiB,QAAUoB,GAAM,CAC3C,MAAMC,EAAOD,EAAE,OAAO,QAAQ,aAAa,EACvCC,GAAQA,EAAK,QAAQ,IAAMpB,IAC7Bc,EAAoBM,EAAK,QAAQ,GAAIpB,EAAaC,CAAW,EAC7D,OAAO,SAAS,CAAE,IAAK,EAAG,SAAU,QAAQ,CAAE,EAElD,CAAC,CACH,EAGAH,EAAW"}