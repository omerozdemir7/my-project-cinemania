import{c as V,d as J,u as H,r as n,j as e,L as X,b as Q,g as Z,e as ee,h as te,i as se,a as ae,k as ie,l as ne,m as re,n as oe}from"./index-Bu0V3sux.js";import{u as le}from"./useLibrary-fUSqNood.js";const ce="movieComments",de=12,me=4,p={tr:"izle",en:"watch",fr:"regarder",de:"anschauen",es:"ver",it:"guarda",pt:"assistir",ru:"смотреть",ar:"شاهد",fa:"تماشا",zh:"观看",ja:"見る",ko:"보기"};function $(a){return`${ce}:${a}`}function he(){const a=document.cookie.match(/(?:^|;\s*)googtrans=([^;]+)/);if(a?.[1]){const r=decodeURIComponent(a[1]).split("/").filter(Boolean),o=r[r.length-1];if(o)return o.toLowerCase()}return(document.documentElement.lang||navigator.language||"en").toLowerCase()}function ue(a){if(!a)return p.en;const d=a.split("-")[0];return p[a]||p[d]||p.en}function A(a){return!a||!Number.isFinite(a)?"N/A":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(a)}function w(a){if(!a)return"N/A";const d=new Date(a);return Number.isNaN(d.getTime())?"N/A":d.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}function ve(a,d,v=""){const r=encodeURIComponent(d),o=a.toLowerCase();return o.includes("netflix")?`https://www.netflix.com/search?q=${r}`:o.includes("amazon")||o.includes("prime")?`https://www.primevideo.com/search/ref=atv_nb_sr?phrase=${r}`:o.includes("disney")?`https://www.disneyplus.com/search?q=${r}`:o.includes("apple")?`https://tv.apple.com/search?term=${r}`:o.includes("blutv")?`https://www.blutv.com/arama?q=${r}`:o.includes("mubi")?`https://mubi.com/tr/search/films?query=${r}`:v||`https://www.google.com/search?q=${r}+watch`}function xe({onWatchTrailer:a,onRequireLogin:d}){const v=V(),{movieId:r}=J(),{user:o}=H(),{isInLibrary:x,addToLibrary:E,removeFromLibrary:F}=le(),[P,j]=n.useState(!0),[s,f]=n.useState(null),[g,R]=n.useState(null),[C,U]=n.useState([]),[S,B]=n.useState([]),[k,q]=n.useState(""),[_,L]=n.useState(""),[M,D]=n.useState(""),[N,b]=n.useState([]),l=Number(r);n.useEffect(()=>{if(!Number.isFinite(l)){j(!1),f(null);return}(async()=>{j(!0);try{const[i,c,h,y,Y]=await Promise.all([ae(l),ie(l),ne(l),re(l),oe(l)]);f(i||null),R(c||null),U((h?.cast||[]).slice(0,de)),B((y?.results||[]).slice(0,me));const I=Y?.results||[],K=I.find(u=>u.site==="YouTube"&&u.type==="Trailer")||I.find(u=>u.site==="YouTube"&&u.type==="Teaser");q(K?.key||"")}catch(i){console.error("[MovieDetailsPage] Failed to load movie data:",i),f(null)}finally{j(!1)}})()},[l]),n.useEffect(()=>{if(!Number.isFinite(l))return;const t=$(l);try{const i=localStorage.getItem(t),c=i?JSON.parse(i):[];b(Array.isArray(c)?c:[])}catch{b([])}},[l]);const m=n.useMemo(()=>g?.results&&(g.results.TR||g.results.US)||null,[g]),T=n.useMemo(()=>{if(!m)return[];const t=[...m.flatrate||[],...m.rent||[],...m.buy||[]],i=new Map;return t.forEach(c=>{c?.provider_id&&!i.has(c.provider_id)&&i.set(c.provider_id,c)}),Array.from(i.values()).slice(0,12)},[m]),z=()=>{if(!s)return;const t=he(),i=t.split("-")[0],c=ue(t),h=document.querySelector(".movie-details-title")?.textContent?.trim()||s.title,y=encodeURIComponent(`${h} ${c}`);window.open(`https://www.google.com/search?q=${y}&hl=${encodeURIComponent(i)}`,"_blank")},W=async()=>{if(s)try{x(s.id)?await F(s.id):await E(s.id)}catch(t){if((typeof t?.code=="string"?t.code:"").includes("login-required")){if(typeof d=="function"){d();return}alert("Please sign in to manage your library.");return}alert("Library update failed. Please try again.")}},G=t=>{if(t.preventDefault(),!Number.isFinite(l))return;const i=_.trim();if(i.length<3){D("Comment must be at least 3 characters.");return}const h=[{id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,author:o?.email||"Guest",text:i,createdAt:new Date().toISOString()},...N];b(h),L(""),D("");try{localStorage.setItem($(l),JSON.stringify(h))}catch{}};if(P)return e.jsx(X,{});if(!s)return e.jsx("section",{className:"movie-details-empty",children:e.jsxs("div",{className:"container",children:[e.jsx("h1",{children:"Movie not found"}),e.jsx(Q,{to:"/catalog",className:"btn btn-primary",children:"Back to Catalog"})]})});const O=s.release_date?new Date(s.release_date).getFullYear():"N/A";return e.jsxs("div",{className:"movie-details-page",children:[e.jsx("section",{className:"movie-details-hero",style:{backgroundImage:`linear-gradient(180deg, rgba(8,8,8,0.55) 0%, rgba(8,8,8,0.95) 100%), url('${Z(s.backdrop_path||s.poster_path,"w1280")}')`},children:e.jsxs("div",{className:"container movie-details-hero-inner",children:[e.jsx("button",{type:"button",className:"movie-details-back-btn",onClick:()=>v(-1),children:"Back"}),e.jsxs("div",{className:"movie-details-hero-grid",children:[e.jsx("div",{className:"movie-details-poster-wrap",children:e.jsx("img",{src:ee(s.poster_path),alt:s.title,className:"movie-details-poster",decoding:"async",width:"500",height:"750"})}),e.jsxs("div",{className:"movie-details-main",children:[e.jsx("h1",{className:"movie-details-title",children:s.title}),e.jsxs("p",{className:"movie-details-subtitle",children:[O," | ",s.runtime||"N/A"," min |"," ",s.status||"Unknown"]}),e.jsxs("div",{className:"movie-details-badges",children:[e.jsxs("span",{className:"movie-badge",children:["TMDB ",s.vote_average?.toFixed(1)||"N/A"]}),e.jsxs("span",{className:"movie-badge",children:[s.vote_count||0," votes"]}),e.jsx("span",{className:"movie-badge",children:s.original_language?.toUpperCase()||"N/A"})]}),e.jsx("p",{className:"movie-details-overview",children:s.overview||"No overview available."}),e.jsxs("div",{className:"movie-details-actions",children:[e.jsx("button",{type:"button",className:`btn-modal-add ${x(s.id)?"btn-remove":""}`,onClick:W,children:x(s.id)?"Remove from my library":"Add to my library"}),e.jsx("button",{type:"button",className:"btn-modal-google",onClick:z,children:"Search on Google"}),e.jsx("button",{type:"button",className:"btn btn-secondary movie-details-trailer-btn",onClick:()=>a?.(k||null),children:"Watch Trailer"})]}),e.jsxs("div",{className:"movie-details-meta-grid",children:[e.jsxs("div",{children:[e.jsx("span",{children:"Release Date"}),e.jsx("strong",{children:w(s.release_date)})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Genres"}),e.jsx("strong",{children:s.genres?.length?s.genres.map(t=>t.name).join(", "):"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Budget"}),e.jsx("strong",{children:A(s.budget)})]}),e.jsxs("div",{children:[e.jsx("span",{children:"Revenue"}),e.jsx("strong",{children:A(s.revenue)})]})]})]})]})]})}),e.jsx("section",{className:"movie-details-section",children:e.jsxs("div",{className:"container",children:[e.jsx("h2",{className:"movie-details-section-title",children:"Cast"}),C.length===0?e.jsx("p",{className:"movie-details-fallback",children:"Cast data is not available."}):e.jsx("div",{className:"movie-cast-grid",children:C.map(t=>e.jsxs("article",{className:"cast-card",children:[e.jsx("img",{src:t.profile_path?`https://image.tmdb.org/t/p/w185${t.profile_path}`:"https://via.placeholder.com/300x450?text=No+Photo",alt:t.name,loading:"lazy",decoding:"async"}),e.jsxs("div",{className:"cast-card-body",children:[e.jsx("h3",{children:t.name}),e.jsx("p",{children:t.character||"Unknown role"})]})]},t.cast_id||`${t.id}-${t.name}`))})]})}),e.jsx("section",{className:"movie-details-section",children:e.jsxs("div",{className:"container",children:[e.jsx("h2",{className:"movie-details-section-title",children:"Where to Watch"}),T.length===0?e.jsx("p",{className:"movie-details-fallback",children:"Provider data is not available for this region."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"provider-grid",children:T.map(t=>e.jsxs("button",{type:"button",className:"provider-card",onClick:()=>window.open(ve(t.provider_name||"",s.title||"",m?.link||""),"_blank"),children:[e.jsx("img",{src:se(t.logo_path,"w154"),srcSet:te(t.logo_path,["w92","w154","w300"]),sizes:"80px",alt:t.provider_name,loading:"lazy",decoding:"async"}),e.jsx("span",{children:t.provider_name})]},t.provider_id))}),m?.link&&e.jsx("a",{href:m.link,target:"_blank",rel:"noopener noreferrer",className:"watch-link movie-watch-link",children:"View all provider options"})]})]})}),e.jsx("section",{className:"movie-details-section",children:e.jsxs("div",{className:"container",children:[e.jsx("h2",{className:"movie-details-section-title",children:"TMDB Reviews"}),S.length===0?e.jsx("p",{className:"movie-details-fallback",children:"No reviews available yet."}):e.jsx("div",{className:"review-list",children:S.map(t=>e.jsxs("article",{className:"review-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.author||"Anonymous"}),e.jsx("time",{children:w(t.created_at)})]}),e.jsx("p",{children:(t.content||"").slice(0,500)||"No review text."})]},t.id))})]})}),e.jsx("section",{className:"movie-details-section movie-comment-section",children:e.jsxs("div",{className:"container",children:[e.jsx("h2",{className:"movie-details-section-title",children:"Your Comments"}),e.jsxs("form",{className:"comment-form",onSubmit:G,children:[e.jsx("label",{htmlFor:"movie-comment-input",children:"Write a comment"}),e.jsx("textarea",{id:"movie-comment-input",value:_,onChange:t=>L(t.target.value),placeholder:"Share your thoughts about this movie...",rows:4,maxLength:800}),M&&e.jsx("p",{className:"comment-error",children:M}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Post Comment"})]}),N.length===0?e.jsx("p",{className:"movie-details-fallback",children:"No comments yet. Be the first one."}):e.jsx("div",{className:"comment-list",children:N.map(t=>e.jsxs("article",{className:"comment-card",children:[e.jsxs("header",{children:[e.jsx("h3",{children:t.author}),e.jsx("time",{children:w(t.createdAt)})]}),e.jsx("p",{children:t.text})]},t.id))})]})})]})}export{xe as MovieDetailsPage};
