{"version":3,"file":"my-library-DWMlZxmN.js","sources":["../../src/js/my-library.js"],"sourcesContent":["// src/js/my-library.js\r\n\r\nimport { getUserLibrary, auth } from './auth.js';\r\nimport { onAuthStateChanged } from \"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js\";\r\nimport { fetchMovieDetails } from './movies-data.js';\r\nimport { renderMovieCard, updateHeroWithMovie } from './ui-helpers.js';\r\nimport { showLoader, hideLoader } from './loader.js';\r\n\r\nconst initLibrary = () => {\r\n  const libraryGrid = document.getElementById('library-grid');\r\n  const heroSection = document.getElementById('library-hero');\r\n  const heroContent = document.getElementById('library-hero-content');\r\n  \r\n  // Filter Elementleri\r\n  const genreFilterContainer = document.getElementById('genre-filter-container');\r\n  const genreHeader = document.getElementById('genre-header');\r\n  const genreList = document.getElementById('genre-list');\r\n  const selectedGenreText = document.getElementById('selected-genre-text');\r\n\r\n  let allMoviesData = [];\r\n\r\n  // Boş mesaj elementi\r\n  let emptyMsg = document.getElementById('empty-library-msg');\r\n  if (!emptyMsg && libraryGrid) {\r\n    emptyMsg = document.createElement('div');\r\n    emptyMsg.id = 'empty-library-msg';\r\n    emptyMsg.className = 'empty-library is-hidden';\r\n    emptyMsg.innerHTML = `\r\n      <p>OOPS...</p>\r\n      <p>You haven't added any movies yet.</p>\r\n      <a href=\"catalog.html\" style=\"color:var(--primary-orange, orange); margin-top:15px; display:inline-block;\">Go to Catalog</a>\r\n    `;\r\n    if(libraryGrid.parentNode) libraryGrid.parentNode.insertBefore(emptyMsg, libraryGrid);\r\n  }\r\n\r\n  if (!libraryGrid) return;\r\n\r\n  // --- LİSTEYİ YÜKLEME FONKSİYONU ---\r\n  async function loadLibraryMovies() {\r\n    showLoader();\r\n    libraryGrid.innerHTML = '';\r\n    if (emptyMsg) emptyMsg.classList.add('is-hidden');\r\n    if (genreFilterContainer) genreFilterContainer.classList.add('is-hidden'); // Yüklenirken gizle\r\n\r\n    try {\r\n      const movieIds = await getUserLibrary();\r\n\r\n      // Kütüphane boşsa\r\n      if (!movieIds || movieIds.length === 0) {\r\n        hideLoader();\r\n        if (emptyMsg) emptyMsg.classList.remove('is-hidden');\r\n        if (heroSection) heroSection.style.backgroundImage = 'none';\r\n        if (heroContent) heroContent.innerHTML = '<h1>Your Library is Empty</h1>';\r\n        // Kütüphane boşsa filtreyi de gizle\r\n        if (genreFilterContainer) genreFilterContainer.style.display = 'none'; \r\n        return;\r\n      }\r\n\r\n      // Doluysa filtreyi görünür yap (css class kontrolü)\r\n      if (genreFilterContainer) {\r\n        genreFilterContainer.style.display = 'block';\r\n        genreFilterContainer.classList.remove('is-hidden'); \r\n      }\r\n\r\n      const promises = movieIds.map(id => fetchMovieDetails(id));\r\n      const movies = await Promise.all(promises);\r\n\r\n      allMoviesData = movies.filter(m => m !== null);\r\n      \r\n      renderMovies(allMoviesData);\r\n      setupGenreFilter(allMoviesData);\r\n\r\n      if (allMoviesData.length > 0 && heroSection) {\r\n        updateHeroWithMovie(allMoviesData[0].id, heroSection, heroContent);\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error(\"Kütüphane yüklenirken hata:\", error);\r\n      libraryGrid.innerHTML = '<p style=\"color:white; text-align:center;\">Bir hata oluştu.</p>';\r\n    } finally {\r\n      hideLoader();\r\n    }\r\n  }\r\n\r\n  // --- FİLMLERİ EKRA NA BASMA ---\r\n  function renderMovies(movies) {\r\n    if (!movies || movies.length === 0) {\r\n        libraryGrid.innerHTML = '<p style=\"color:white; text-align:center; grid-column: 1/-1;\">No movies found for this genre.</p>';\r\n        return;\r\n    }\r\n    libraryGrid.innerHTML = movies.map(m => renderMovieCard(m)).join('');\r\n  }\r\n\r\n  // --- GENRE FILTER MANTIĞI (GÜÇLENDİRİLMİŞ) ---\r\n  function setupGenreFilter(movies) {\r\n    if (!genreList || !genreHeader) return;\r\n\r\n    const genresMap = new Map();\r\n    \r\n    movies.forEach(movie => {\r\n        // Güvenlik Kontrolü: movie.genres var mı ve dizi mi?\r\n        if (movie && movie.genres && Array.isArray(movie.genres)) {\r\n            movie.genres.forEach(g => {\r\n                if(g && g.id && g.name) {\r\n                    genresMap.set(g.id, g.name);\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    // Eğer hiç tür bulunamadıysa filtreyi yine de oluştur (All Genres olarak)\r\n    let html = `<div class=\"genre-item active\" data-id=\"all\">All Genres</div>`;\r\n    \r\n    genresMap.forEach((name, id) => {\r\n        html += `<div class=\"genre-item\" data-id=\"${id}\">${name}</div>`;\r\n    });\r\n\r\n    genreList.innerHTML = html;\r\n\r\n    // Tıklama Olayı: Header\r\n    genreHeader.onclick = (e) => {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        genreList.classList.toggle('is-hidden');\r\n        genreFilterContainer.classList.toggle('is-open');\r\n    };\r\n\r\n    // Tıklama Olayı: Seçenekler\r\n    const genreItems = genreList.querySelectorAll('.genre-item');\r\n    genreItems.forEach(item => {\r\n        item.onclick = (e) => {\r\n            e.stopPropagation();\r\n            \r\n            genreItems.forEach(el => el.classList.remove('active'));\r\n            item.classList.add('active');\r\n\r\n            const selectedId = item.dataset.id;\r\n            const selectedName = item.textContent;\r\n\r\n            if (selectedGenreText) selectedGenreText.textContent = selectedName;\r\n\r\n            genreList.classList.add('is-hidden');\r\n            genreFilterContainer.classList.remove('is-open');\r\n\r\n            filterMovies(selectedId);\r\n        };\r\n    });\r\n\r\n    // Dışarı tıklama kapatma\r\n    document.addEventListener('click', (e) => {\r\n        if (genreFilterContainer && !genreFilterContainer.contains(e.target)) {\r\n            genreList.classList.add('is-hidden');\r\n            genreFilterContainer.classList.remove('is-open');\r\n        }\r\n    });\r\n  }\r\n\r\n  function filterMovies(genreId) {\r\n      let filteredMovies = [];\r\n\r\n      if (genreId === 'all') {\r\n          filteredMovies = allMoviesData;\r\n      } else {\r\n          // Güvenli Filtreleme\r\n          filteredMovies = allMoviesData.filter(movie => \r\n              movie.genres && \r\n              Array.isArray(movie.genres) &&\r\n              movie.genres.some(g => g.id.toString() === genreId.toString())\r\n          );\r\n      }\r\n\r\n      renderMovies(filteredMovies);\r\n  }\r\n\r\n  // Firebase Auth Dinleyici\r\n  onAuthStateChanged(auth, (user) => {\r\n    loadLibraryMovies();\r\n  });\r\n  \r\n  libraryGrid.addEventListener('click', (e) => {\r\n    const card = e.target.closest('.movie-card');\r\n    if (card && card.dataset.id && heroSection) {\r\n      updateHeroWithMovie(card.dataset.id, heroSection, heroContent);\r\n      window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    }\r\n  });\r\n};\r\n\r\n// DOM Hazır olduğunda başlat\r\ndocument.addEventListener('DOMContentLoaded', initLibrary);"],"names":["initLibrary","libraryGrid","heroSection","heroContent","genreFilterContainer","genreHeader","genreList","selectedGenreText","allMoviesData","emptyMsg","loadLibraryMovies","showLoader","movieIds","getUserLibrary","hideLoader","promises","id","fetchMovieDetails","m","renderMovies","setupGenreFilter","updateHeroWithMovie","error","movies","renderMovieCard","genresMap","movie","g","html","name","e","genreItems","item","el","selectedId","selectedName","filterMovies","genreId","filteredMovies","onAuthStateChanged","auth","user","card"],"mappings":"6TAQA,MAAMA,EAAc,IAAM,CACxB,MAAMC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAc,SAAS,eAAe,sBAAsB,EAG5DC,EAAuB,SAAS,eAAe,wBAAwB,EACvEC,EAAc,SAAS,eAAe,cAAc,EACpDC,EAAY,SAAS,eAAe,YAAY,EAChDC,EAAoB,SAAS,eAAe,qBAAqB,EAEvE,IAAIC,EAAgB,CAAA,EAGhBC,EAAW,SAAS,eAAe,mBAAmB,EAa1D,GAZI,CAACA,GAAYR,IACfQ,EAAW,SAAS,cAAc,KAAK,EACvCA,EAAS,GAAK,oBACdA,EAAS,UAAY,0BACrBA,EAAS,UAAY;AAAA;AAAA;AAAA;AAAA,MAKlBR,EAAY,YAAYA,EAAY,WAAW,aAAaQ,EAAUR,CAAW,GAGlF,CAACA,EAAa,OAGlB,eAAeS,GAAoB,CACjCC,IACAV,EAAY,UAAY,GACpBQ,GAAUA,EAAS,UAAU,IAAI,WAAW,EAC5CL,GAAsBA,EAAqB,UAAU,IAAI,WAAW,EAExE,GAAI,CACF,MAAMQ,EAAW,MAAMC,IAGvB,GAAI,CAACD,GAAYA,EAAS,SAAW,EAAG,CACtCE,IACIL,GAAUA,EAAS,UAAU,OAAO,WAAW,EAC/CP,IAAaA,EAAY,MAAM,gBAAkB,QACjDC,IAAaA,EAAY,UAAY,kCAErCC,IAAsBA,EAAqB,MAAM,QAAU,QAC/D,MACF,CAGIA,IACFA,EAAqB,MAAM,QAAU,QACrCA,EAAqB,UAAU,OAAO,WAAW,GAGnD,MAAMW,EAAWH,EAAS,IAAII,GAAMC,EAAkBD,CAAE,CAAC,EAGzDR,GAFe,MAAM,QAAQ,IAAIO,CAAQ,GAElB,OAAOG,GAAKA,IAAM,IAAI,EAE7CC,EAAaX,CAAa,EAC1BY,EAAiBZ,CAAa,EAE1BA,EAAc,OAAS,GAAKN,GAC9BmB,EAAoBb,EAAc,CAAC,EAAE,GAAIN,EAAaC,CAAW,CAGrE,OAASmB,EAAO,CACd,QAAQ,MAAM,8BAA+BA,CAAK,EAClDrB,EAAY,UAAY,iEAC1B,QAAC,CACCa,GACF,CACF,CAGA,SAASK,EAAaI,EAAQ,CAC5B,GAAI,CAACA,GAAUA,EAAO,SAAW,EAAG,CAChCtB,EAAY,UAAY,oGACxB,MACJ,CACAA,EAAY,UAAYsB,EAAO,IAAIL,GAAKM,EAAgBN,CAAC,CAAC,EAAE,KAAK,EAAE,CACrE,CAGA,SAASE,EAAiBG,EAAQ,CAChC,GAAI,CAACjB,GAAa,CAACD,EAAa,OAEhC,MAAMoB,EAAY,IAAI,IAEtBF,EAAO,QAAQG,GAAS,CAEhBA,GAASA,EAAM,QAAU,MAAM,QAAQA,EAAM,MAAM,GACnDA,EAAM,OAAO,QAAQC,GAAK,CACnBA,GAAKA,EAAE,IAAMA,EAAE,MACdF,EAAU,IAAIE,EAAE,GAAIA,EAAE,IAAI,CAElC,CAAC,CAET,CAAC,EAGD,IAAIC,EAAO,gEAEXH,EAAU,QAAQ,CAACI,EAAMb,IAAO,CAC5BY,GAAQ,oCAAoCZ,CAAE,KAAKa,CAAI,QAC3D,CAAC,EAEDvB,EAAU,UAAYsB,EAGtBvB,EAAY,QAAWyB,GAAM,CACzBA,EAAE,gBAAe,EACjBA,EAAE,eAAc,EAChBxB,EAAU,UAAU,OAAO,WAAW,EACtCF,EAAqB,UAAU,OAAO,SAAS,CACnD,EAGA,MAAM2B,EAAazB,EAAU,iBAAiB,aAAa,EAC3DyB,EAAW,QAAQC,GAAQ,CACvBA,EAAK,QAAWF,GAAM,CAClBA,EAAE,gBAAe,EAEjBC,EAAW,QAAQE,GAAMA,EAAG,UAAU,OAAO,QAAQ,CAAC,EACtDD,EAAK,UAAU,IAAI,QAAQ,EAE3B,MAAME,EAAaF,EAAK,QAAQ,GAC1BG,EAAeH,EAAK,YAEtBzB,IAAmBA,EAAkB,YAAc4B,GAEvD7B,EAAU,UAAU,IAAI,WAAW,EACnCF,EAAqB,UAAU,OAAO,SAAS,EAE/CgC,EAAaF,CAAU,CAC3B,CACJ,CAAC,EAGD,SAAS,iBAAiB,QAAUJ,GAAM,CAClC1B,GAAwB,CAACA,EAAqB,SAAS0B,EAAE,MAAM,IAC/DxB,EAAU,UAAU,IAAI,WAAW,EACnCF,EAAqB,UAAU,OAAO,SAAS,EAEvD,CAAC,CACH,CAEA,SAASgC,EAAaC,EAAS,CAC3B,IAAIC,EAAiB,CAAA,EAEjBD,IAAY,MACZC,EAAiB9B,EAGjB8B,EAAiB9B,EAAc,OAAOkB,GAClCA,EAAM,QACN,MAAM,QAAQA,EAAM,MAAM,GAC1BA,EAAM,OAAO,KAAKC,GAAKA,EAAE,GAAG,SAAQ,IAAOU,EAAQ,UAAU,CAC3E,EAGMlB,EAAamB,CAAc,CAC/B,CAGAC,EAAmBC,EAAOC,GAAS,CACjC/B,GACF,CAAC,EAEDT,EAAY,iBAAiB,QAAU,GAAM,CAC3C,MAAMyC,EAAO,EAAE,OAAO,QAAQ,aAAa,EACvCA,GAAQA,EAAK,QAAQ,IAAMxC,IAC7BmB,EAAoBqB,EAAK,QAAQ,GAAIxC,EAAaC,CAAW,EAC7D,OAAO,SAAS,CAAE,IAAK,EAAG,SAAU,QAAQ,CAAE,EAElD,CAAC,CACH,EAGA,SAAS,iBAAiB,mBAAoBH,CAAW"}