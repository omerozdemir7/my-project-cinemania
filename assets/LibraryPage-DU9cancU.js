import{r as i,a as A,j as s,L as D,H as O,b as P,M as $}from"./index-izTSw8yN.js";import{u as F}from"./useLibrary-B6wyBFbg.js";function T({onMovieClick:S,onWatchTrailer:M}){const{library:l,loading:h}=F(),[N,f]=i.useState(!0),[b,m]=i.useState(null),[o,v]=i.useState([]),[g,c]=i.useState([]),[y,k]=i.useState([]),[d,L]=i.useState("all"),[u,p]=i.useState(!1),x=i.useRef(null);i.useEffect(()=>{h||C()},[l,h]),i.useEffect(()=>{const e=t=>{x.current&&!x.current.contains(t.target)&&p(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);const C=async()=>{if(!l||l.length===0){f(!1),m(null),v([]),c([]);return}f(!0);try{const e=l.map(r=>A(r)),n=(await Promise.all(e)).filter(r=>r!==null);v(n),c(n),n.length>0&&(m(n[0]),G(n))}catch(e){console.error("Kütüphane yüklenirken hata:",e)}finally{f(!1)}},G=e=>{const t=new Map;e.forEach(r=>{r&&r.genres&&Array.isArray(r.genres)&&r.genres.forEach(a=>{a&&a.id&&a.name&&t.set(a.id,a.name)})});const n=Array.from(t,([r,a])=>({id:r,name:a}));k(n)},j=e=>{if(L(e),p(!1),e==="all")c(o);else{const t=o.filter(n=>n.genres&&Array.isArray(n.genres)&&n.genres.some(r=>r.id.toString()===e.toString()));c(t)}},w=e=>{const t=g.find(n=>n.id===e)||o.find(n=>n.id===e);t&&m(t),window.scrollTo({top:0,behavior:"smooth"})},E=()=>{if(d==="all")return"Genre";const e=y.find(t=>t.id.toString()===d.toString());return e?e.name:"Genre"};return N||h?s.jsx(D,{}):s.jsxs(s.Fragment,{children:[s.jsx(O,{movie:b,onWatchTrailer:M,onMoreDetails:S,children:o.length===0&&s.jsx("h1",{children:"Your Library is Empty"})}),s.jsx("section",{className:"library-content-section",children:s.jsx("div",{className:"container",children:o.length===0?s.jsxs("div",{className:"empty-library",children:[s.jsx("p",{children:"OOPS..."}),s.jsx("p",{children:"You haven't added any movies yet."}),s.jsx(P,{to:"/catalog",className:"btn-modal-add",style:{display:"inline-block",marginTop:"20px",textDecoration:"none"},children:"Go to Catalog"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:`genre-filter-container ${u?"is-open":""}`,ref:x,children:[s.jsxs("div",{className:"genre-header",onClick:e=>{e.stopPropagation(),p(!u)},children:[s.jsx("span",{children:E()}),s.jsx("i",{className:"fas fa-chevron-down"})]}),s.jsxs("div",{className:`genre-list ${u?"":"is-hidden"}`,children:[s.jsx("div",{className:`genre-item ${d==="all"?"active":""}`,onClick:()=>j("all"),children:"All Genres"}),y.map(e=>s.jsx("div",{className:`genre-item ${d===e.id.toString()?"active":""}`,onClick:()=>j(e.id.toString()),children:e.name},e.id))]})]}),g.length===0?s.jsx("p",{style:{color:"white",textAlign:"center",gridColumn:"1/-1"},children:"No movies found for this genre."}):s.jsx("div",{className:"movie-grid-container",children:g.map(e=>s.jsx($,{movie:e,onClick:w},e.id))})]})})})]})}export{T as LibraryPage};
